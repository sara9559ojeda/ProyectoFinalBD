<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestión de Reclamos</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .header h1 {
            color: #4a4a4a;
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-bottom: 30px;
        }

        .nav-tab {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            padding: 15px 25px;
            border-radius: 15px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .nav-tab:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .nav-tab.active {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            transform: translateY(-2px);
        }

        .content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #74b9ff, #0984e3);
        }

        .btn-danger {
            background: linear-gradient(45deg, #fd79a8, #e84393);
        }

        .btn-success {
            background: linear-gradient(45deg, #55efc4, #00b894);
        }

        .table-container {
            overflow-x: auto;
            margin-top: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        th,
        td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            font-weight: 600;
        }

        tr:hover {
            background: rgba(102, 126, 234, 0.05);
        }

        .alert {
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            font-weight: 500;
        }

        .alert-success {
            background: rgba(85, 239, 196, 0.2);
            border: 1px solid #55efc4;
            color: #00b894;
        }

        .alert-error {
            background: rgba(253, 121, 168, 0.2);
            border: 1px solid #fd79a8;
            color: #e84393;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7));
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        @media (max-width: 768px) {
            .nav-tabs {
                flex-direction: column;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .container {
                padding: 10px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>Sistema de Gestión de Reclamos</h1>
            <p>Administra clientes, productos, ventas, reclamos y soporte técnico</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showSection('dashboard')">Dashboard</button>
            <button class="nav-tab" onclick="showSection('clientes')">Clientes</button>
            <button class="nav-tab" onclick="showSection('productos')">Productos</button>
            <button class="nav-tab" onclick="showSection('ventas')">Ventas</button>
            <button class="nav-tab" onclick="showSection('reclamos')">Reclamos</button>
            <button class="nav-tab" onclick="showSection('soportes')">Soporte</button>
            <button class="nav-tab" onclick="showSection('tecnicos')">Técnicos</button>
            <button class="nav-tab" onclick="showSection('reportes')">Reportes</button>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboard" class="content section active">
            <h2>Dashboard</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalClientes">-</div>
                    <div>Total Clientes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalProductos">-</div>
                    <div>Total Productos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalVentas">-</div>
                    <div>Total Ventas</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalReclamos">-</div>
                    <div>Total Reclamos</div>
                </div>
            </div>
            <button class="btn" onclick="loadDashboard()">Actualizar Dashboard</button>
        </div>

        <!-- Clientes Section -->
        <div id="clientes" class="content section">
            <h2>Gestión de Clientes</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label for="clientName">Nombre Completo</label>
                    <input type="text" id="clientName" placeholder="Nombre completo del cliente">
                </div>
                <div class="form-group">
                    <label for="clientEmail">Email</label>
                    <input type="email" id="clientEmail" placeholder="correo@ejemplo.com">
                </div>
                <div class="form-group">
                    <label for="clientPhone">Teléfono</label>
                    <input type="text" id="clientPhone" placeholder="Número de teléfono">
                </div>
                <div class="form-group">
                    <label for="clientId">Número de Identidad</label>
                    <input type="text" id="clientId" placeholder="Número de identificación">
                </div>
                <div class="form-group">
                    <label for="clientAddress">Dirección</label>
                    <input type="text" id="clientAddress" placeholder="Dirección completa">
                </div>
            </div>
            <div>
                <button class="btn" onclick="createClient()">Crear Cliente</button>
                <button class="btn btn-secondary" onclick="loadClients()">Cargar Clientes</button>
                <button class="btn btn-danger" onclick="clearClientForm()">Limpiar</button>
            </div>
            <div id="clientsTable" class="table-container"></div>
        </div>

        <!-- Productos Section -->
        <div id="productos" class="content section">
            <h2>Gestión de Productos</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label for="productName">Nombre del Producto</label>
                    <input type="text" id="productName" placeholder="Nombre del producto">
                </div>
                <div class="form-group">
                    <label for="productDescription">Descripción</label>
                    <textarea id="productDescription" placeholder="Descripción del producto" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="productPrice">Precio</label>
                    <input type="number" id="productPrice" step="0.01" placeholder="0.00">
                </div>
                <div class="form-group">
                    <label for="productWarranty">Garantía</label>
                    <input type="text" id="productWarranty" placeholder="Términos de garantía">
                </div>
            </div>
            <div>
                <button class="btn" onclick="createProduct()">Crear Producto</button>
                <button class="btn btn-secondary" onclick="loadProducts()">Cargar Productos</button>
                <button class="btn btn-danger" onclick="clearProductForm()">Limpiar</button>
            </div>
            <div id="productsTable" class="table-container"></div>
        </div>

        <!-- Ventas Section -->
        <div id="ventas" class="content section">
            <h2>Gestión de Ventas</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label for="saleClient">Cliente</label>
                    <select id="saleClient">
                        <option value="">Seleccionar cliente</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="saleProduct">Producto</label>
                    <select id="saleProduct">
                        <option value="">Seleccionar producto</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="saleDate">Fecha de Venta</label>
                    <input type="date" id="saleDate">
                </div>
            </div>
            <div>
                <button class="btn" onclick="createSale()">Crear Venta</button>
                <button class="btn btn-secondary" onclick="loadSales()">Cargar Ventas</button>
                <button class="btn btn-danger" onclick="clearSaleForm()">Limpiar</button>
            </div>
            <div id="salesTable" class="table-container"></div>
        </div>

        <!-- Reclamos Section -->
        <div id="reclamos" class="content section">
            <h2>Gestión de Reclamos</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label for="claimSale">Venta</label>
                    <select id="claimSale">
                        <option value="">Seleccionar venta</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="claimDate">Fecha del Reclamo</label>
                    <input type="date" id="claimDate">
                </div>
                <div class="form-group">
                    <label for="claimType">Tipo</label>
                    <select id="claimType">
                        <option value="">Seleccionar tipo</option>
                        <option value="Defecto">Defecto</option>
                        <option value="Garantia">Garantía</option>
                        <option value="Servicio">Servicio</option>
                        <option value="Otro">Otro</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="claimStatus">Estado</label>
                    <select id="claimStatus">
                        <option value="">Seleccionar estado</option>
                        <option value="Pendiente">Pendiente</option>
                        <option value="En Proceso">En Proceso</option>
                        <option value="Resuelto">Resuelto</option>
                        <option value="Cerrado">Cerrado</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="claimDescription">Descripción</label>
                    <textarea id="claimDescription" placeholder="Descripción del reclamo" rows="3"></textarea>
                </div>
            </div>
            <div>
                <button class="btn" onclick="createClaim()">Crear Reclamo</button>
                <button class="btn btn-secondary" onclick="loadClaims()">Cargar Reclamos</button>
                <button class="btn btn-danger" onclick="clearClaimForm()">Limpiar</button>
            </div>
            <div id="claimsTable" class="table-container"></div>
        </div>

        <!-- Soporte Section -->
        <div id="soportes" class="content section">
            <h2>Gestión de Soporte</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label for="supportClaim">Reclamo</label>
                    <select id="supportClaim">
                        <option value="">Seleccionar reclamo</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="supportTechnician">Técnico</label>
                    <select id="supportTechnician">
                        <option value="">Seleccionar técnico</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="supportStartDate">Fecha de Inicio</label>
                    <input type="date" id="supportStartDate">
                </div>
                <div class="form-group">
                    <label for="supportEndDate">Fecha de Fin</label>
                    <input type="date" id="supportEndDate">
                </div>
                <div class="form-group">
                    <label for="supportAction">Acción Tomada</label>
                    <textarea id="supportAction" placeholder="Descripción de la acción tomada" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="supportResult">Resultado</label>
                    <textarea id="supportResult" placeholder="Resultado de la acción" rows="3"></textarea>
                </div>
            </div>
            <div>
                <button class="btn" onclick="createSupport()">Crear Soporte</button>
                <button class="btn btn-secondary" onclick="loadSupports()">Cargar Soportes</button>
                <button class="btn btn-danger" onclick="clearSupportForm()">Limpiar</button>
            </div>
            <div id="supportsTable" class="table-container"></div>
        </div>

        <!-- Técnicos Section -->
        <div id="tecnicos" class="content section">
            <h2>Gestión de Técnicos</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label for="technicianName">Nombre Completo</label>
                    <input type="text" id="technicianName" placeholder="Nombre completo del técnico">
                </div>
                <div class="form-group">
                    <label for="technicianSpecialty">Especialidad</label>
                    <input type="text" id="technicianSpecialty" placeholder="Especialidad técnica">
                </div>
            </div>
            <div>
                <button class="btn" onclick="createTechnician()">Crear Técnico</button>
                <button class="btn btn-secondary" onclick="loadTechnicians()">Cargar Técnicos</button>
                <button class="btn btn-danger" onclick="clearTechnicianForm()">Limpiar</button>
            </div>
            <div id="techniciansTable" class="table-container"></div>
        </div>

        <!-- Reportes Section -->
        <div id="reportes" class="content section">
            <h2>Reportes y Consultas</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <button class="btn" onclick="loadTopClients()">Clientes con Más Reclamos</button>
                    <p>Últimos 6 meses</p>
                </div>
                <div class="stat-card">
                    <button class="btn" onclick="loadTopProducts()">Productos con Más Reclamos</button>
                    <p>Todos los períodos</p>
                </div>
                <div class="stat-card">
                    <button class="btn" onclick="loadFastResolutions()">Reclamos Resueltos Rápido</button>
                    <p>Menos de 7 días</p>
                </div>
                <div class="stat-card">
                    <button class="btn" onclick="loadAverageResolutionTime()">Tiempo Promedio</button>
                    <p>Resolución de reclamos</p>
                </div>
            </div>
            <div id="reportsContainer"></div>
        </div>
    </div>

    <!-- Modal for editing -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <h3 id="modalTitle">Editar</h3>
            <div id="modalBody"></div>
            <div>
                <button class="btn" onclick="saveEdit()">Guardar</button>
                <button class="btn btn-danger" onclick="closeModal()">Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8080/api';

        let currentEditItem = null;
        let currentEditType = null;

        // Navigation
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            document.getElementById(sectionId).classList.add('active');
            event.target.classList.add('active');

            // Load data when switching sections
            switch (sectionId) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'clientes':
                    loadClients();
                    break;
                case 'productos':
                    loadProducts();
                    break;
                case 'ventas':
                    loadSales();
                    loadClientsForSelect();
                    loadProductsForSelect();
                    break;
                case 'reclamos':
                    loadClaims();
                    loadSalesForSelect();
                    break;
                case 'soportes':
                    loadSupports();
                    loadClaimsForSelect();
                    loadTechniciansForSelect();
                    break;
                case 'tecnicos':
                    loadTechnicians();
                    break;
            }
        }

        // Utility functions
        function showAlert(message, type = 'success') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;

            document.querySelector('.content.active').insertBefore(
                alertDiv,
                document.querySelector('.content.active').firstChild
            );

            setTimeout(() => alertDiv.remove(), 5000);
        }

        async function apiRequest(url, options = {}) {
            try {
                const response = await fetch(`${API_BASE}${url}`, {
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                if (response.status === 204) {
                    return null;
                }

                return await response.json();
            } catch (error) {
                console.error('API Error:', error);
                showAlert(`Error: ${error.message}`, 'error');
                throw error;
            }
        }

        // Dashboard functions
        async function loadDashboard() {
            try {
                const [clients, products, sales, claims] = await Promise.all([
                    apiRequest('/clientes'),
                    apiRequest('/productos'),
                    apiRequest('/ventas'),
                    apiRequest('/reclamos')
                ]);

                document.getElementById('totalClientes').textContent = clients.length;
                document.getElementById('totalProductos').textContent = products.length;
                document.getElementById('totalVentas').textContent = sales.length;
                document.getElementById('totalReclamos').textContent = claims.length;
            } catch (error) {
                console.error('Error loading dashboard:', error);
            }
        }

        // Client functions
        async function createClient() {
            const client = {
                fullName: document.getElementById('clientName').value,
                email: document.getElementById('clientEmail').value,
                phone: document.getElementById('clientPhone').value,
                identificationNumber: document.getElementById('clientId').value,
                address: document.getElementById('clientAddress').value
            };

            if (!client.fullName) {
                showAlert('El nombre es requerido', 'error');
                return;
            }

            try {
                await apiRequest('/clientes', {
                    method: 'POST',
                    body: JSON.stringify(client)
                });
                showAlert('Cliente creado exitosamente');
                clearClientForm();
                loadClients();
            } catch (error) {
                console.error('Error creating client:', error);
            }
        }

        async function loadClients() {
            try {
                const clients = await apiRequest('/clientes');
                displayClientsTable(clients);
            } catch (error) {
                console.error('Error loading clients:', error);
            }
        }

        function displayClientsTable(clients) {
            const tableHtml = `
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Nombre</th>
                            <th>Email</th>
                            <th>Teléfono</th>
                            <th>Identificación</th>
                            <th>Dirección</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${clients.map(client => `
                            <tr>
                                <td>${client.clientId}</td>
                                <td>${client.fullName}</td>
                                <td>${client.email || '-'}</td>
                                <td>${client.phone || '-'}</td>
                                <td>${client.identificationNumber || '-'}</td>
                                <td>${client.address || '-'}</td>
                                <td>
                                    <button class="btn btn-secondary" onclick="editClient(${client.clientId})">Editar</button>
                                    <button class="btn btn-danger" onclick="deleteClient(${client.clientId})">Eliminar</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            document.getElementById('clientsTable').innerHTML = tableHtml;
        }

        async function deleteClient(id) {
            if (!confirm('¿Está seguro de eliminar este cliente?')) return;

            try {
                await apiRequest(`/clientes/${id}`, { method: 'DELETE' });
                showAlert('Cliente eliminado exitosamente');
                loadClients();
            } catch (error) {
                console.error('Error deleting client:', error);
            }
        }

        function clearClientForm() {
            document.getElementById('clientName').value = '';
            document.getElementById('clientEmail').value = '';
            document.getElementById('clientPhone').value = '';
            document.getElementById('clientId').value = '';
            document.getElementById('clientAddress').value = '';
        }

        // Product functions
        async function createProduct() {
            const product = {
                name: document.getElementById('productName').value,
                description: document.getElementById('productDescription').value,
                price: parseFloat(document.getElementById('productPrice').value),
                warranty: document.getElementById('productWarranty').value
            };

            if (!product.name || !product.price) {
                showAlert('Nombre y precio son requeridos', 'error');
                return;
            }

            try {
                await apiRequest('/productos', {
                    method: 'POST',
                    body: JSON.stringify(product)
                });
                showAlert('Producto creado exitosamente');
                clearProductForm();
                loadProducts();
            } catch (error) {
                console.error('Error creating product:', error);
            }
        }

        async function loadProducts() {
            try {
                const products = await apiRequest('/productos');
                displayProductsTable(products);
            } catch (error) {
                console.error('Error loading products:', error);
            }
        }

        function displayProductsTable(products) {
            const tableHtml = `
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Nombre</th>
                            <th>Descripción</th>
                            <th>Precio</th>
                            <th>Garantía</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${products.map(product => `
                            <tr>
                                <td>${product.productId}</td>
                                <td>${product.name}</td>
                                <td>${product.description || '-'}</td>
                                <td>${product.price}</td>
                                <td>${product.warranty || '-'}</td>
                                <td>
                                    <button class="btn btn-secondary" onclick="editProduct(${product.productId})">Editar</button>
                                    <button class="btn btn-danger" onclick="deleteProduct(${product.productId})">Eliminar</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            document.getElementById('productsTable').innerHTML = tableHtml;
        }

        async function deleteProduct(id) {
            if (!confirm('¿Está seguro de eliminar este producto?')) return;

            try {
                await apiRequest(`/productos/${id}`, { method: 'DELETE' });
                showAlert('Producto eliminado exitosamente');
                loadProducts();
            } catch (error) {
                console.error('Error deleting product:', error);
            }
        }

        function clearProductForm() {
            document.getElementById('productName').value = '';
            document.getElementById('productDescription').value = '';
            document.getElementById('productPrice').value = '';
            document.getElementById('productWarranty').value = '';
        }

        // Sale functions
        async function createSale() {
            const sale = {
                client: { clientId: parseInt(document.getElementById('saleClient').value) },
                product: { productId: parseInt(document.getElementById('saleProduct').value) },
                saleDate: document.getElementById('saleDate').value
            };

            if (!sale.client.clientId || !sale.product.productId || !sale.saleDate) {
                showAlert('Todos los campos son requeridos', 'error');
                return;
            }

            try {
                await apiRequest('/ventas', {
                    method: 'POST',
                    body: JSON.stringify(sale)
                });
                showAlert('Venta creada exitosamente');
                clearSaleForm();
                loadSales();
            } catch (error) {
                console.error('Error creating sale:', error);
            }
        }

        async function loadSales() {
            try {
                const sales = await apiRequest('/ventas');
                displaySalesTable(sales);
            } catch (error) {
                console.error('Error loading sales:', error);
            }
        }

        function displaySalesTable(sales) {
            const tableHtml = `
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Cliente</th>
                            <th>Producto</th>
                            <th>Fecha</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${sales.map(sale => `
                            <tr>
                                <td>${sale.saleId}</td>
                                <td>${sale.client?.fullName || 'N/A'}</td>
                                <td>${sale.product?.name || 'N/A'}</td>
                                <td>${sale.saleDate}</td>
                                <td>
                                    <button class="btn btn-secondary" onclick="editSale(${sale.saleId})">Editar</button>
                                    <button class="btn btn-danger" onclick="deleteSale(${sale.saleId})">Eliminar</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            document.getElementById('salesTable').innerHTML = tableHtml;
        }

        async function deleteSale(id) {
            if (!confirm('¿Está seguro de eliminar esta venta?')) return;

            try {
                await apiRequest(`/ventas/${id}`, { method: 'DELETE' });
                showAlert('Venta eliminada exitosamente');
                loadSales();
            } catch (error) {
                console.error('Error deleting sale:', error);
            }
        }

        function clearSaleForm() {
            document.getElementById('saleClient').value = '';
            document.getElementById('saleProduct').value = '';
            document.getElementById('saleDate').value = '';
        }

        async function loadClientsForSelect() {
            try {
                const clients = await apiRequest('/clientes');
                const select = document.getElementById('saleClient');
                select.innerHTML = '<option value="">Seleccionar cliente</option>';
                clients.forEach(client => {
                    select.innerHTML += `<option value="${client.clientId}">${client.fullName}</option>`;
                });
            } catch (error) {
                console.error('Error loading clients for select:', error);
            }
        }

        async function loadProductsForSelect() {
            try {
                const products = await apiRequest('/productos');
                const select = document.getElementById('saleProduct');
                select.innerHTML = '<option value="">Seleccionar producto</option>';
                products.forEach(product => {
                    select.innerHTML += `<option value="${product.productId}">${product.name}</option>`;
                });
            } catch (error) {
                console.error('Error loading products for select:', error);
            }
        }

        // Claim functions
        async function createClaim() {
            const claim = {
                sale: { saleId: parseInt(document.getElementById('claimSale').value) },
                claimDate: document.getElementById('claimDate').value,
                type: document.getElementById('claimType').value,
                status: document.getElementById('claimStatus').value,
                description: document.getElementById('claimDescription').value
            };

            if (!claim.sale.saleId || !claim.claimDate || !claim.type || !claim.status) {
                showAlert('Todos los campos obligatorios son requeridos', 'error');
                return;
            }

            try {
                await apiRequest('/reclamos', {
                    method: 'POST',
                    body: JSON.stringify(claim)
                });
                showAlert('Reclamo creado exitosamente');
                clearClaimForm();
                loadClaims();
            } catch (error) {
                console.error('Error creating claim:', error);
            }
        }

        async function loadClaims() {
            try {
                const claims = await apiRequest('/reclamos');
                displayClaimsTable(claims);
            } catch (error) {
                console.error('Error loading claims:', error);
            }
        }

        function displayClaimsTable(claims) {
            const tableHtml = `
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Venta ID</th>
                            <th>Fecha</th>
                            <th>Tipo</th>
                            <th>Estado</th>
                            <th>Descripción</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${claims.map(claim => `
                            <tr>
                                <td>${claim.claimId}</td>
                                <td>${claim.sale?.saleId || 'N/A'}</td>
                                <td>${claim.claimDate}</td>
                                <td>${claim.type}</td>
                                <td>${claim.status}</td>
                                <td>${claim.description || '-'}</td>
                                <td>
                                    <button class="btn btn-secondary" onclick="editClaim(${claim.claimId})">Editar</button>
                                    <button class="btn btn-danger" onclick="deleteClaim(${claim.claimId})">Eliminar</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            document.getElementById('claimsTable').innerHTML = tableHtml;
        }

        async function deleteClaim(id) {
            if (!confirm('¿Está seguro de eliminar este reclamo?')) return;

            try {
                await apiRequest(`/reclamos/${id}`, { method: 'DELETE' });
                showAlert('Reclamo eliminado exitosamente');
                loadClaims();
            } catch (error) {
                console.error('Error deleting claim:', error);
            }
        }

        function clearClaimForm() {
            document.getElementById('claimSale').value = '';
            document.getElementById('claimDate').value = '';
            document.getElementById('claimType').value = '';
            document.getElementById('claimStatus').value = '';
            document.getElementById('claimDescription').value = '';
        }

        async function loadSalesForSelect() {
            try {
                const sales = await apiRequest('/ventas');
                const select = document.getElementById('claimSale');
                select.innerHTML = '<option value="">Seleccionar venta</option>';
                sales.forEach(sale => {
                    const clientName = sale.client?.fullName || 'Cliente desconocido';
                    const productName = sale.product?.name || 'Producto desconocido';
                    select.innerHTML += `<option value="${sale.saleId}">Venta ${sale.saleId} - ${clientName} - ${productName}</option>`;
                });
            } catch (error) {
                console.error('Error loading sales for select:', error);
            }
        }

        // Support functions
        async function createSupport() {
            const support = {
                claim: { claimId: parseInt(document.getElementById('supportClaim').value) },
                technician: { technicianId: parseInt(document.getElementById('supportTechnician').value) },
                startDate: document.getElementById('supportStartDate').value,
                endDate: document.getElementById('supportEndDate').value,
                actionTaken: document.getElementById('supportAction').value,
                result: document.getElementById('supportResult').value
            };

            if (!support.claim.claimId || !support.technician.technicianId || !support.startDate) {
                showAlert('Reclamo, técnico y fecha de inicio son requeridos', 'error');
                return;
            }

            try {
                await apiRequest('/soportes', {
                    method: 'POST',
                    body: JSON.stringify(support)
                });
                showAlert('Soporte creado exitosamente');
                clearSupportForm();
                loadSupports();
            } catch (error) {
                console.error('Error creating support:', error);
            }
        }

        async function loadSupports() {
            try {
                const supports = await apiRequest('/soportes');
                displaySupportsTable(supports);
            } catch (error) {
                console.error('Error loading supports:', error);
            }
        }

        function displaySupportsTable(supports) {
            const tableHtml = `
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Reclamo ID</th>
                            <th>Técnico</th>
                            <th>Fecha Inicio</th>
                            <th>Fecha Fin</th>
                            <th>Acción</th>
                            <th>Resultado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${supports.map(support => `
                            <tr>
                                <td>${support.idSupport}</td>
                                <td>${support.claim?.claimId || 'N/A'}</td>
                                <td>${support.technician?.fullName || 'N/A'}</td>
                                <td>${support.startDate}</td>
                                <td>${support.endDate || '-'}</td>
                                <td>${support.actionTaken || '-'}</td>
                                <td>${support.result || '-'}</td>
                                <td>
                                    <button class="btn btn-secondary" onclick="editSupport(${support.idSupport})">Editar</button>
                                    <button class="btn btn-danger" onclick="deleteSupport(${support.idSupport})">Eliminar</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            document.getElementById('supportsTable').innerHTML = tableHtml;
        }

        async function deleteSupport(id) {
            if (!confirm('¿Está seguro de eliminar este soporte?')) return;

            try {
                await apiRequest(`/soportes/${id}`, { method: 'DELETE' });
                showAlert('Soporte eliminado exitosamente');
                loadSupports();
            } catch (error) {
                console.error('Error deleting support:', error);
            }
        }

        function clearSupportForm() {
            document.getElementById('supportClaim').value = '';
            document.getElementById('supportTechnician').value = '';
            document.getElementById('supportStartDate').value = '';
            document.getElementById('supportEndDate').value = '';
            document.getElementById('supportAction').value = '';
            document.getElementById('supportResult').value = '';
        }

        async function loadClaimsForSelect() {
            try {
                const claims = await apiRequest('/reclamos');
                const select = document.getElementById('supportClaim');
                select.innerHTML = '<option value="">Seleccionar reclamo</option>';
                claims.forEach(claim => {
                    select.innerHTML += `<option value="${claim.claimId}">Reclamo ${claim.claimId} - ${claim.type} - ${claim.status}</option>`;
                });
            } catch (error) {
                console.error('Error loading claims for select:', error);
            }
        }

        async function loadTechniciansForSelect() {
            try {
                const technicians = await apiRequest('/tecnicos');
                const select = document.getElementById('supportTechnician');
                select.innerHTML = '<option value="">Seleccionar técnico</option>';
                technicians.forEach(technician => {
                    select.innerHTML += `<option value="${technician.technicianId}">${technician.fullName} - ${technician.specialty}</option>`;
                });
            } catch (error) {
                console.error('Error loading technicians for select:', error);
            }
        }

        // Technician functions
        async function createTechnician() {
            const technician = {
                fullName: document.getElementById('technicianName').value,
                specialty: document.getElementById('technicianSpecialty').value
            };

            if (!technician.fullName || !technician.specialty) {
                showAlert('Nombre y especialidad son requeridos', 'error');
                return;
            }

            try {
                await apiRequest('/tecnicos', {
                    method: 'POST',
                    body: JSON.stringify(technician)
                });
                showAlert('Técnico creado exitosamente');
                clearTechnicianForm();
                loadTechnicians();
            } catch (error) {
                console.error('Error creating technician:', error);
            }
        }

        async function loadTechnicians() {
            try {
                const technicians = await apiRequest('/tecnicos');
                displayTechniciansTable(technicians);
            } catch (error) {
                console.error('Error loading technicians:', error);
            }
        }

        function displayTechniciansTable(technicians) {
            const tableHtml = `
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Nombre</th>
                            <th>Especialidad</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${technicians.map(technician => `
                            <tr>
                                <td>${technician.technicianId}</td>
                                <td>${technician.fullName}</td>
                                <td>${technician.specialty}</td>
                                <td>
                                    <button class="btn btn-secondary" onclick="editTechnician(${technician.technicianId})">Editar</button>
                                    <button class="btn btn-danger" onclick="deleteTechnician(${technician.technicianId})">Eliminar</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            document.getElementById('techniciansTable').innerHTML = tableHtml;
        }

        async function deleteTechnician(id) {
            if (!confirm('¿Está seguro de eliminar este técnico?')) return;

            try {
                await apiRequest(`/tecnicos/${id}`, { method: 'DELETE' });
                showAlert('Técnico eliminado exitosamente');
                loadTechnicians();
            } catch (error) {
                console.error('Error deleting technician:', error);
            }
        }

        function clearTechnicianForm() {
            document.getElementById('technicianName').value = '';
            document.getElementById('technicianSpecialty').value = '';
        }

        // Reports functions
        async function loadTopClients() {
            try {
                const data = await apiRequest('/reclamos/consultas/clientes-top');
                displayReport('Clientes con Más Reclamos (Últimos 6 meses)', data, ['cliente', 'totalReclamos']);
            } catch (error) {
                console.error('Error loading top clients:', error);
            }
        }

        async function loadTopProducts() {
            try {
                const data = await apiRequest('/reclamos/consultas/productos-top');
                displayReport('Productos con Más Reclamos', data, ['nombreProducto', 'totalReclamos']);
            } catch (error) {
                console.error('Error loading top products:', error);
            }
        }

        async function loadFastResolutions() {
            try {
                const data = await apiRequest('/reclamos/consultas/resueltos-rapido');
                if (data && data.length > 0) {
                    const tableHtml = `
                        <h3>Reclamos Resueltos en Menos de 7 Días</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>ID Reclamo</th>
                                    <th>Fecha</th>
                                    <th>Tipo</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.map(claim => `
                                    <tr>
                                        <td>${claim.claimId}</td>
                                        <td>${claim.claimDate}</td>
                                        <td>${claim.type}</td>
                                        <td>${claim.status}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;
                    document.getElementById('reportsContainer').innerHTML = tableHtml;
                } else {
                    document.getElementById('reportsContainer').innerHTML = '<p>No hay reclamos resueltos en menos de 7 días.</p>';
                }
            } catch (error) {
                console.error('Error loading fast resolutions:', error);
            }
        }

        async function loadAverageResolutionTime() {
            try {
                const avgTime = await apiRequest('/reclamos/consultas/tiempo-promedio-resolucion');
                document.getElementById('reportsContainer').innerHTML = `
                    <div class="stat-card">
                        <div class="stat-number">${avgTime.toFixed(1)}</div>
                        <div>Días promedio de resolución</div>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading average resolution time:', error);
            }
        }

        function displayReport(title, data, columns) {
            if (!data || data.length === 0) {
                document.getElementById('reportsContainer').innerHTML = `<p>No hay datos para mostrar en: ${title}</p>`;
                return;
            }

            const tableHtml = `
                <h3>${title}</h3>
                <table>
                    <thead>
                        <tr>
                            ${columns.map(col => `<th>${col}</th>`).join('')}
                        </tr>
                    </thead>
                    <tbody>
                        ${data.map(row => `
                            <tr>
                                ${columns.map(col => `<td>${row[col]}</td>`).join('')}
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            document.getElementById('reportsContainer').innerHTML = tableHtml;
        }

        // Edit functions (placeholder implementations)
        async function editClient(id) {
            const updatedClient = {
                fullName: document.getElementById('clientName').value,
                email: document.getElementById('clientEmail').value,
                phone: document.getElementById('clientPhone').value,
                identificationNumber: document.getElementById('clientId').value,
                address: document.getElementById('clientAddress').value
            };

            if (!updatedClient.fullName) {
                showAlert('El nombre es requerido', 'error');
                return;
            }

            try {
                await apiRequest(`/clientes/${id}`, {
                    method: 'PUT',
                    body: JSON.stringify(updatedClient)
                });
                showAlert('Cliente actualizado exitosamente');
                clearClientForm();
                loadClients();
            } catch (error) {
                console.error('Error updating client:', error);
                showAlert('Hubo un error al actualizar el cliente', 'error');
            }
        }


        async function editProduct(id) {
            const updatedProduct = {
                name: document.getElementById('productName').value,
                description: document.getElementById('productDescription').value,
                price: parseFloat(document.getElementById('productPrice').value),
                warranty: document.getElementById('productWarranty').value
            };

            if (!updatedProduct.name || isNaN(updatedProduct.price)) {
                showAlert('Nombre y precio son requeridos', 'error');
                return;
            }

            try {
                await apiRequest(`/productos/${id}`, {
                    method: 'PUT',
                    body: JSON.stringify(updatedProduct)
                });
                showAlert('Producto actualizado exitosamente');
                clearProductForm();
                loadProducts();
            } catch (error) {
                console.error('Error updating product:', error);
                showAlert('Hubo un error al actualizar el producto', 'error');
            }
        }


        async function editSale(id) {
            const updatedSale = {
                client: { clientId: parseInt(document.getElementById('saleClient').value) },
                product: { productId: parseInt(document.getElementById('saleProduct').value) },
                saleDate: document.getElementById('saleDate').value
            };

            if (!updatedSale.client.clientId || !updatedSale.product.productId || !updatedSale.saleDate) {
                showAlert('Todos los campos son requeridos', 'error');
                return;
            }

            try {
                await apiRequest(`/ventas/${id}`, {
                    method: 'PUT',
                    body: JSON.stringify(updatedSale)
                });
                showAlert('Venta actualizada exitosamente');
                clearSaleForm();
                loadSales();
            } catch (error) {
                console.error('Error updating sale:', error);
                showAlert('Hubo un error al actualizar la venta', 'error');
            }
        }


        async function editClaim(id) {
            const updatedClaim = {
                sale: { saleId: parseInt(document.getElementById('claimSale').value) },
                claimDate: document.getElementById('claimDate').value,
                type: document.getElementById('claimType').value,
                status: document.getElementById('claimStatus').value,
                description: document.getElementById('claimDescription').value
            };

            if (!updatedClaim.sale.saleId || !updatedClaim.claimDate || !updatedClaim.type || !updatedClaim.status) {
                showAlert('Todos los campos obligatorios son requeridos', 'error');
                return;
            }

            try {
                await apiRequest(`/reclamos/${id}`, {
                    method: 'PUT',
                    body: JSON.stringify(updatedClaim)
                });
                showAlert('Reclamo actualizado exitosamente');
                clearClaimForm();
                loadClaims();
            } catch (error) {
                console.error('Error updating claim:', error);
                showAlert('Hubo un error al actualizar el reclamo', 'error');
            }
        }


        async function editSupport(id) {
            const updatedSupport = {
                claim: { claimId: parseInt(document.getElementById('supportClaim').value) },
                technician: { technicianId: parseInt(document.getElementById('supportTechnician').value) },
                startDate: document.getElementById('supportStartDate').value,
                endDate: document.getElementById('supportEndDate').value,
                actionTaken: document.getElementById('supportAction').value,
                result: document.getElementById('supportResult').value
            };

            if (!updatedSupport.claim.claimId || !updatedSupport.technician.technicianId || !updatedSupport.startDate) {
                showAlert('Reclamo, técnico y fecha de inicio son requeridos', 'error');
                return;
            }

            try {
                await apiRequest(`/soportes/${id}`, {
                    method: 'PUT',
                    body: JSON.stringify(updatedSupport)
                });
                showAlert('Soporte actualizado exitosamente');
                clearSupportForm();
                loadSupports();
            } catch (error) {
                console.error('Error updating support:', error);
                showAlert('Hubo un error al actualizar el soporte', 'error');
            }
        }


        async function editTechnician(id) {
            const updatedTechnician = {
                fullName: document.getElementById('technicianName').value,
                specialty: document.getElementById('technicianSpecialty').value
            };

            if (!updatedTechnician.fullName || !updatedTechnician.specialty) {
                showAlert('Nombre y especialidad son requeridos', 'error');
                return;
            }

            try {
                await apiRequest(`/tecnicos/${id}`, {
                    method: 'PUT',
                    body: JSON.stringify(updatedTechnician)
                });
                showAlert('Técnico actualizado exitosamente');
                clearTechnicianForm();
                loadTechnicians();
            } catch (error) {
                console.error('Error updating technician:', error);
                showAlert('Hubo un error al actualizar el técnico', 'error');
            }
        }


        function closeModal() {
            document.getElementById('editModal').style.display = 'none';
            currentEditItem = null;
            currentEditType = null;
        }

        function saveEdit() {
            showAlert('Funcionalidad de guardado en desarrollo', 'error');
        }

        // Initialize dashboard on page load
        document.addEventListener('DOMContentLoaded', function () {
            loadDashboard();

            // Set today's date as default for date inputs
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('saleDate').value = today;
            document.getElementById('claimDate').value = today;
            document.getElementById('supportStartDate').value = today;
        });
    </script>
</body>

</html>